<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    />
    <link rel="stylesheet" href="/stylesheets/styles.css" />
    <style>
      body,
      html {
        height: 100vh;
        width: 100vw;
        -ms-overflow-style: none;
        scrollbar-width: none;
      }

      .hide-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }

      .hide-scrollbar::-webkit-scrollbar {
        display: none;
      }
    </style>
  </head>

  <body class="">
    <!-- Flash Messages -->

    <div
      id="main"
      class="h-[100vh] w-full px-3 overflow-y-auto flex flex-col gap-10 hide-scrollbar scroll-smooth"
    >
      <div
        class="h-[90px] w-full sticky top-0 bg-white z-50 peer-checked:bg-black"
      >
        <% if (messages && messages.error) { %>
        <div
          class="absolute top-5 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-red-500 text-white p-3 rounded-lg shadow-lg z-60 mt-5 flash-msg"
        >
          <span class="inline-block"> <%= messages.error %> </span>
        </div>
        <% } %> <% if (messages && messages.success) { %>

        <div
          class="absolute top-5 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-green-500 text-white p-3 rounded-lg shadow-lg z-60 mt-5 flash-msg"
        >
          <span class="inline-block"> <%= messages.success %> </span>
        </div>
        <% } %>
        <div id="topsec" class="h-full w-full text-[#34664f]">
          <div
            class="w-full h-[80px] flex items-center justify-between border-b-2 border-black
            sm:h-[100px]"
          >
            <div class="w-1/3 h-full pl-10 flex justify-start items-center">
              <h1 class="text-xl
              sm:text-5xl sm:pl-10">Cart</h1>
            </div>
            <div
              class="w-1/3 h-full pr-10 flex justify-end gap-10 items-center text-3xl"
            >
              <a href="/shop/<%= user.id %>" class="hover:text-[#f1a155]">
                <i class="fa-solid fa-house"></i>
              </a>
              <a
                href="/users/account/<%= user.id %>"
                class="hover:text-[#f1a155]"
              >
                <i class="fa-solid fa-user"></i>
              </a>
            </div>
          </div>
        </div>
      </div>
      <% let totalAmt=0 %> <% let totalDisc=0 %> <% let totalShip=0 %> <%
      if(user.cart.length> 0){ %> 
        <% user.cart.forEach(function(val){ %>
            <div class="h-1/3 w-full flex gap-2 shrink-0 z-10
                sm:h-96 sm:w-full sm:flex sm:items-center sm:gap-5 item sm:shrink-0 sm:z-10">
                <div id="left-sec" class="h-3/4 w-[40%] rounded-md overflow-hidden
                sm:h-full md:w-[27%]">
                <div
                    class="h-[70%] w-full flex items-center justify-center"
                    style="background-color: #<%= val.bgcolor %>"
                >
                    <img
                    src="/uploads/<%= val.image %>"
                    alt=""
                    class="h-[80%] w-[80%] object-contain overflow-hidden"
                    />
                </div>
                <div
                    class="h-[17%] w-full flex items-center gap-2
                    sm:gap-30"
                    style="background-color: #<%= val.panelcolor %>"
                >
                    <div class="h-full w-full text-lg flex items-center justify-center 
                    sm:text-2xl sm:w-[40%] sm:pl-8">
                    <h1 class="text-center"><%= val.name %></h1>
                    </div>
                    <div
                    class="h-full w-[10%] gap-2 text-black hidden
                    sm:h-full sm:w-[30%] sm:flex sm:items-center sm:justify-center"
                    >
                    <button>
                        <div
                        class="h-3 w-3 rounded-full bg-white flex justify-center items-center 
                        sm:h-6 sm:w-6"
                        >
                        <h1 class="text-xl font-bold leading-none pb-1">+</h1>
                        </div>
                    </button>
                    <div
                        class="h-3 w-4 bg-white text-center text-md relative pb-[2px]
                        sm:h-6 sm:w-6 sm:text-xl"
                    >
                        <h1 class="leading-none p-[1px]">01</h1>
                    </div>
                    <button>
                        <div
                        class="h-6 w-6 rounded-full bg-white flex justify-center items-center"
                        >
                        <h1 class="text-xl font-bold leading-none pb-1">-</h1>
                        </div>
                    </button>
                    </div>
                </div>
                <div
                    class="h-[13%] w-full flex gap-2 text-white items-center pl-4 text-sm
                    sm:text-xl sm:pl-8 sm:pr-26"
                    style="background-color: #<%= val.textcolor %>"
                >
                    <p class="text-sm">Total</p>
                    <p>₹<%= val.price + 20 - val.discount %></p>
                </div>
                </div>
                <div id="right-sec" class="h-full w-1/2">
                <p class="text-lg font-semibold 
                sm:text-2xl sm:font-semibold sm:pl-2">Price breakdown</p>
                <div class="h-[45%] w-full flex items-center gap-6 mt-2
                sm:mt-7 sm:gap-6">
                    <div class="h-full w-[80%] text-sm flex flex-col gap-1 ml-1
                    sm:gap-2 sm:ml-5">
                    <p class="
                    sm:text-lg sm:font-semibold" style="font-size: 14px;">MRP</p>
                    <p class="text-sm 
                    sm:text-lg sm:font-semibold" style="font-size: 14px;">Discount</p>
                    <p class="text-sm
                    sm:text-lg sm:font-semibold" style="font-size: 14px;">Platform</p>
                    <p class="text-sm 
                    sm:text-lg sm:font-semibold" style="font-size: 14px;">Shipping</p>
                    </div>
                    <div class="h-full w-[40%] flex flex-col gap-1
                    sm:gap-2 ">
                    <p class="text-sm 
                    sm:text-lg sm:font-semibold" style="font-size: 14px;">₹<%= val.price %></p>
                    <p class="text-sm 
                    sm:text-lg" style="font-size: 14px;">₹<%= val.discount %></p>
                    <p class="text-sm 
                    sm:text-lg" style="font-size: 14px;">₹20</p>
                    <p class="text-sm 
                    sm:text-lg font-semibold" style="font-size: 14px;"><% let Ship=0 %>FREE</p>
                    </div>
                </div>
                <div class="h-[2px] w-full bg-zinc-300 mt-1"></div>
                <div
                    class="h-[20%] w-full flex items-start pl-1 gap-2 pr-[36%] pt-2
                    sm:pt-5 sm:pl-5 sm:justify-between sm:pr-[56%]"
                >
                    <p class="text-md
                    sm:text-xl sm:font-semibold">Total</p>
                    <p class="text-md
                    sm:text-xl text-green-400 sm:font-semibold">
                    <% let total=val.price + 20 - val.discount %>
                    ₹<%= total %>
                    </p>
                </div>
                <div class="w-full flex items-center gap-5
                sm:gap-10">
                    <div
                    class="h-10 w-32 sm:w-36 bg-black rounded-md text-center flex justify-center items-center text-md text-white
                    sm:ml-5 ml-2"
                    >
                        <a href="/users/orders/<%= val.id %>" class="w-full h-full flex items-center justify-center text-sm sm:text-md">Order Now</a>
                    </div>
                    <div
                      class="h-10 w-28 bg-red-500 rounded-md ml-2 flex justify-center items-center text-base text-white
                      sm:w-36 sm:ml-5 sm:text-xl"
                    >
                      <button class="w-full h-full">
                        <a href="/removefromcart/<%= val.id %>" class="w-full h-full flex items-center justify-center">
                          <span class="sm:inline">Remove Item </span>
                        </a>
                      </button>
                    </div>
                </div>
                <% totalAmt +=total %> <% totalDisc +=val.discount %> <% totalShip
                +=Ship %>
                </div>
            </div>
            <% }) %> <% } else{ %>
            <h1>NO Products in cart</h1>
            <% } %>
      <div class="w-full flex justify-center">
        <div
          class="w-[95%] sm:w-[80%] bg-[#356650] rounded-2xl sm:rounded-4xl flex flex-col sm:flex-row justify-between items-center py-4 sm:py-0 h-auto sm:h-20"
        >
          <div class="flex flex-row sm:flex-col items-center sm:items-start w-full sm:w-auto justify-between sm:justify-start px-4 sm:px-0 mb-2 sm:mb-0">
            <div>
              <p class="text-white font-semibold text-lg sm:text-2xl ml-0 sm:ml-5">Total Amount</p>
              <p class="text-white font-semibold text-lg sm:text-2xl ml-0 sm:ml-5">
                ₹<%= totalAmt %>
              </p>
            </div>
            <div class="sm:hidden w-px h-8 bg-white mx-4"></div>
            <div>
              <p class="text-white font-semibold text-lg sm:text-2xl ml-0 sm:ml-5">You Saved!!</p>
              <p class="text-white font-semibold text-lg sm:text-2xl ml-0 sm:ml-5">
                ₹<%= totalDisc %>
              </p>
            </div>
            <div class="sm:hidden w-px h-8 bg-white mx-4"></div>
            <div>
              <p class="text-white font-semibold text-lg sm:text-2xl ml-0 sm:ml-5">Shipping</p>
              <p class="text-white font-semibold text-lg sm:text-2xl ml-0 sm:ml-5">
                ₹<%= totalShip %>
              </p>
            </div>
          </div>
          <% if(user.cart.length> 0) { %>
          <div class="flex gap-2 sm:gap-4 h-10 sm:h-12 w-full sm:w-auto justify-center sm:justify-end mt-2 sm:mt-0">
            <a
              href="/users/cart/orders/<%= user._id %>"
              class="h-full w-full sm:w-60 bg-[#F1A155] rounded-2xl sm:rounded-4xl text-white text-lg sm:text-xl font-semibold flex items-center justify-center mr-0 sm:mr-5"
            >
              Continue
            </a>
          </div>
          <!-- <a href="/dummy-payment/<%= user._id %>" class="h-full w-60 bg-[] rounded-4xl text-white text-xl font-semibold mr-5 flex items-center justify-center">
                    <i class="fas fa-credit-card mr-2"></i>
                    Pay Now
                </a> -->
          <% } %>
        </div>
      </div>
    </div>
    <script>
         // Auto-hide flash messages after 3 seconds
        document.addEventListener('DOMContentLoaded', function() {
            const flashMessages = document.querySelectorAll('.flash-msg');
            flashMessages.forEach(function(msg) {
                setTimeout(function() {
                    msg.classList.add('fade-out');
                    setTimeout(function() {
                        msg.remove();
                    }, 500);
                }, 3000);
            });
        });
    </script>
  </body>
</html>
